{% extends 'base.html' %}

{% block title %}My Blog{% endblock %}

{% block content %}

<div class="textarea-container">
    <form action="/myblog" method="POST">
        <br>
        <button type="button" id="createpostbutton" name="createpostbutton" onclick="createPost()">Create a new post!</button>
        <br>
        
        <textarea id="titleTextarea" name="titleTextarea" style="display: none;" placeholder="Enter the title"></textarea>
        <textarea id="contentTextarea" name="contentTextarea" style="display: none;" placeholder="Write your content here..."></textarea>
        <textarea id="tagTextarea" name="tagTextarea" style="display: none;" placeholder="Enter tags (comma separated)"></textarea>
        
        <input type="hidden" name="user_id" value="{{ session['user_id'] }}">
        
        <br>
        <button type="submit" id="savepostbutton" style="display: none;" onclick="savePost()">Save Post</button>
    </form>
</div>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul id="flashMessages">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<div class="posts-container">
    {% for post in posts %}
        {% if post.user_id == session['user_id'] %}
            <div class="post">
                <h2>{{ post.title }}</h2>
                <hr>
                <p>{{ post.content }}</p><br><br>
                <p><strong>#{{ post.tags }}</strong></p><br><br>
                <p>{{ post.created_date.strftime('%d %B') }}</p><br><br>
                <form action="/delete_post/{{ post.id }}" method="POST" style="display:inline;">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this post?');">Delete</button>
                </form>
            </div>
        {% endif %}
    {% endfor %}
</div>

<script>
    function createPost(){
        const createpost = document.getElementById('createpostbutton');
        const titletextarea = document.getElementById('titleTextarea');
        const contenttextarea = document.getElementById('contentTextarea');
        const tagtextarea = document.getElementById('tagTextarea');            
        const savepost = document.getElementById('savepostbutton');

        if(titletextarea.style.display === 'none'){
            createpost.style.display = 'none';
            titletextarea.style.display = 'block';
            contenttextarea.style.display = 'block';
            tagtextarea.style.display = 'block';
            savepost.style.display = 'inline';
        }
    }

    function savePost(){
        const titletextarea = document.getElementById('titleTextarea');
        const contenttextarea = document.getElementById('contentTextarea');
        const tagtextarea = document.getElementById('tagTextarea');            
        titletextarea.style.display = 'none';
        contenttextarea.style.display = 'none';
        tagtextarea.style.display = 'none';

        document.getElementById('createpostbutton').style.display = 'inline';
        document.getElementById('savepostbutton').style.display = 'none';
    }

    window.onload = function(){
        const flashMessages = document.getElementById('flashMessages');
        if (flashMessages) {
            setTimeout(() => {
                flashMessages.style.display = 'none';
            }, 2000);
        }
    }
</script>

{% endblock %}
