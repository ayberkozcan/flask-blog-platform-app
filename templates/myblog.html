{% extends 'base.html' %}

{% block title %}My Blog{% endblock %}

{% block content %}

<div class="textarea-container">
    <form action="/myblog" method="POST">
        <br>
        <button type="button" id="createpostbutton" name="createpostbutton" onclick="createPost()">Create a new post!</button>
        <br>
        
        <textarea id="titleTextarea" name="titleTextarea" style="display: none;" placeholder="Enter the title"></textarea>
        <textarea id="contentTextarea" name="contentTextarea" style="display: none;" placeholder="Write your content here..."></textarea>
        <textarea id="tagTextarea" name="tagTextarea" style="display: none;" placeholder="Enter tags (comma separated)"></textarea>
        
        <div id="visibility-container" style="display: none;">
            <label for="public">Public</label>
            <input type="radio" id="public" name="visibility" value="public" checked>
            <label for="private">Private</label>
            <input type="radio" id="private" name="visibility" value="private">
        </div>

        <input type="hidden" name="user_id" value="{{ session['user_id'] }}">
        
        <br><br>
        <button type="submit" id="savepostbutton" style="display: none;" onclick="savePost()">Save Post</button><br>
        <button type="button" id="gobackbutton" style="display: none;" onclick="savePost()">Go Back</button>
    </form>
</div>

{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul id="flashMessages">
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<div class="posts-container">
    {% for post in posts %}
        {% if post.user_id == session['user_id'] %}
            <div class="post">
                <label style="font-size: 12px; background-color: lightgray; padding: 2px 5px;">{{ post.ispublic }}</label>
                <br><br>
                <h2>{{ post.title }}</h2>
                <hr>
                <p>{{ post.content }}</p><br><br>
            
                <img src="{{ url_for('static', filename='icons/tag_label_blue_icon.png') }}" alt="Tag Label icon" style="width: 20px; height: auto;">
                <p><strong>{{ post.tags }}</strong></p><br><br>
                
                <p>{{ post.created_date.strftime('%d %B') }}</p><br><br>
            
                <!-- <img src="{{ url_for('static', filename='icons/heart_thin_icon.png') }}" alt="Heart icon" style="width: 20px; height: auto;">
                <p style="margin-right: 10px;">{{ post.like_count }}</p>
                
                <img src="{{ url_for('static', filename='icons/saved_icon.png') }}" alt="Saved icon" style="width: 20px; height: auto;">
                <p>{{ post.save_count }}</p> -->
                
                <!-- <br><br> -->

                <form action="/delete_post/{{ post.id }}" method="POST" style="display:inline;">
                    <button type="submit" onclick="return confirm('Are you sure you want to delete this post?');">Delete This Post</button>
                </form>
            </div>
        {% endif %}
    {% endfor %}
</div>

<script>
    function createPost() {
        document.getElementById("createpostbutton").style.display = "none";
        document.getElementById("titleTextarea").style.display = "block";
        document.getElementById("contentTextarea").style.display = "block";
        document.getElementById("tagTextarea").style.display = "block";
        document.getElementById("visibility-container").style.display = "block";
        document.getElementById("savepostbutton").style.display = "block";
        document.getElementById("gobackbutton").style.display = "block";
    }

    function savePost(){
        const createpost = document.getElementById('createpostbutton');
        const titletextarea = document.getElementById('titleTextarea');
        const contenttextarea = document.getElementById('contentTextarea');
        const tagtextarea = document.getElementById('tagTextarea');            
        titletextarea.style.display = 'none';
        contenttextarea.style.display = 'none';
        tagtextarea.style.display = 'none';

        document.getElementById('createpostbutton').style.display = 'inline';
        document.getElementById('visibility-container').style.display = 'none';
        document.getElementById('savepostbutton').style.display = 'none';
        document.getElementById('gobackbutton').style.display = 'none';
    }

    window.onload = function(){
        const flashMessages = document.getElementById('flashMessages');
        if (flashMessages) {
            setTimeout(() => {
                flashMessages.style.display = 'none';
            }, 2000);
        }
    }
</script>

{% endblock %}
